<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>GUI Builder</title>
		<meta name="description" content="Dialogs template to be used in javascript app.">
		<link rel="stylesheet" href="jslayoutmanager.css">
		<script type="text/javascript" src="jslayoutmanager.js"></script>
		<style type="text/css">
			#box-palette li:hover {background-color:blue; color:white;}
			.outline-target {
				/*outline: #33F 1px solid !important;*/
				outline: 1px solid !important;
			}
			.show-insertion-vb {
				box-shadow: 0 -4px 0 blue  !important;
			}

			.show-insertion-va {
				box-shadow: 0 4px 0 blue  !important;
			}

			.show-insertion-hb {
				box-shadow: -4px 0 0 blue  !important;
			}

			.show-insertion-ha {
				box-shadow: 4px 0 0 blue  !important;
			}
			#tree-browser {overflow:auto;}
		</style>
		<script type="text/javascript">
			//globals
			var drag_mouse_point = false;
			var drag_mouse_clone = false;
			var drag_mouse_target = false;
			var treeViewDOMData;
			var currentWidgetId = false;
			var currentProjectTabId = false;


			function applyLayoutToBody()
			{
				var i, len, layout, children = document.body.children;
				for (i = 0, len = children.length; i < len; ++i)
				{
					layout = children[i].getAttribute('data-layout');
					if (layout)
					{
						JsLayoutManager.manageLayout(children[i]);
					}
				}
				projectChanged(0);
			}
			window.onload = applyLayoutToBody;

			function dockPaletteShowHide(bval)
			{
				//JsLayoutManager[bval ? "elmShow" : "elmHide"](document.getElementById("box-palette"));
				JsLayoutManager.spliterOpenClose(document.getElementById("box-palette").parentNode, 0, bval);
			}

			function dockPropertiesShowHide(bval)
			{
				//JsLayoutManager[bval ? "elmShow" : "elmHide"](document.getElementById("box-properties"));
				JsLayoutManager.spliterOpenClose(document.getElementById("box-properties").parentNode, 1, bval);
			}

			function showHideInsertionPoint(evt, show, elm) {
				if(!elm)
				{
					elm = JsLayoutManager.getEventSource(evt);					
				}
				if (elm) {
					var currClass = elm.className.replace(/\s*\bshow-insertion-[hv][ab]\b/g, '');
					if (show) {
						var isBlock = getComputedStyle(elm, null).display === "block";
						var mousePos = JsLayoutManager.getMousePos(evt);
						//console.log(mousePos.x + " : " + elm.offsetLeft + " :: " + mousePos.y + " : " + elm.offsetTop);
						currClass += " show-insertion-" + (isBlock ? "v" : "h") + "a";
					}
					if (elm.className !== currClass)
						elm.className = currClass;
				}
			}

			function setCssByIds(idsSpaceSeparatedStr, cssProperty, cssValue)
			{
				var ids = idsSpaceSeparatedStr.split(" ");
				for(var i=0, len=ids.length; i<len; ++i)
				{
					var elm = document.getElementById(ids[i]);
					if(elm)
					{
						elm.style[cssProperty] = cssValue;
					}
				}
			}

			function childOf(c,p){while((c=c.parentNode)&&c!==p);return !!c;}

			function isValidToDrop(target)
			{
				var allowedToDrop = document.getElementById(currentProjectTabId);
				return (target === allowedToDrop) || childOf(target, allowedToDrop);
			}

			function handle_mousemove(e) {
				if (drag_mouse_point) {
					var target = JsLayoutManager.getEventSource(e);
					//console.log(target);
					if (target !== drag_mouse_target) {
						if (drag_mouse_target)
						{
							showHideInsertionPoint(e, false, drag_mouse_target);
						}
						if(isValidToDrop(target))
						{
							drag_mouse_target = target;
							showHideInsertionPoint(e, true, drag_mouse_target);
							drag_mouse_clone.style.opacity = 1;
						} else {
							drag_mouse_target = false;
							drag_mouse_clone.style.opacity = 0.5;
						}
					}
					if (drag_mouse_clone)
					{
						drag_mouse_point = JsLayoutManager.getMousePos(e);
						drag_mouse_point.x++;
						drag_mouse_point.y++;
						JsLayoutManager.setCss(drag_mouse_clone, {
							top: JsLayoutManager.addStr_px(drag_mouse_point.y),
							left: JsLayoutManager.addStr_px(drag_mouse_point.x)});
					}
				}
				JsLayoutManager.cancelEvent(e);
			}

			function handle_mouseup(e) {
				if (drag_mouse_point) {
					var target = JsLayoutManager.getEventSource(e);
					//console.log(target);
					if (drag_mouse_clone)
					{
						if(isValidToDrop(target))
						{
							drag_mouse_clone.removeAttribute("style");
							target.appendChild(drag_mouse_clone.parentNode.removeChild(drag_mouse_clone));
						} else {
							drag_mouse_clone.parentNode.removeChild(drag_mouse_clone);
						}
					}
				}
				if (drag_mouse_target)
				{
					showHideInsertionPoint(e, false, drag_mouse_target);
				}
				drag_mouse_point = false;
				drag_mouse_target = false;
				drag_mouse_clone = false;
				JsLayoutManager.cancelEvent(e);
				JsLayoutManager.removeEventMulti(window, "mouseup touchend", handle_mouseup);
				JsLayoutManager.removeEventMulti(window, "mousemove touchmove", handle_mousemove);
				//setCssByIds('box-palette box-properties', "opacity", "");
			}

			function startDragPalette(e)
			{
				var target = JsLayoutManager.getEventSource(e);
				//console.log(target);
				drag_mouse_point = JsLayoutManager.getMousePos(e);
				drag_mouse_point.x++;
				drag_mouse_point.y++;
				var elmType = target.getAttribute("data-type");
				if (elmType)
				{
					drag_mouse_clone = document.createElement(elmType);
					if(elmType === "button")
					{
						drag_mouse_clone.innerHTML = "Button";
					}
				} else {
					drag_mouse_clone = target.cloneNode(true);
				}
				document.body.appendChild(drag_mouse_clone);
				JsLayoutManager.setCss(drag_mouse_clone, {
					outline: "dotted 1px",
					position: "absolute",
					top: JsLayoutManager.addStr_px(drag_mouse_point.y),
					left: JsLayoutManager.addStr_px(drag_mouse_point.x)});
				JsLayoutManager.cancelEvent(e, true);
				JsLayoutManager.addEventMulti(window, "mouseup touchend", handle_mouseup);
				JsLayoutManager.addEventMulti(window, "mousemove touchmove", handle_mousemove);
			}
			
			function getClassNameOrText(elm) {
				switch (elm.nodeName) {
					case "#comment":
					case "#text":
						var nodeValue = elm.nodeValue;
						var isSpace = JsLayoutManager.isSpace;
						for (var i = 0, len = nodeValue.length; i < len; ++i) {
							if (!isSpace(nodeValue[i])) {
								return nodeValue;
							}
						}

						return "";
						break;
					default:
						return elm.className;
				}
			}

			function showTreeDOM(element, data) {
				var nameOrText = getClassNameOrText(element);
				if (element.nodeName === "#text" && nameOrText === "")
					return "";
				var result = "<ul><li><a href='#' class='a_dt' data-did='" + data.length + "' id='did" + data.length + "'>" + element.nodeName + " : " + nameOrText + "</a>";
				data.push(element);
				var cn = element.childNodes;
				for (var i = 0, cnl = cn.length; i < cnl; i++) {
					var elm = cn[i];
					result += showTreeDOM(elm, data);
				}
				result += "</li></ul>";
				//result += "<pre>" + getStyle(element, "") + "</pre>";
				return result;
			}
			
			function projectChanged(tabId)
			{
				var elm = document.getElementById('tabs-projects');
				var treeBrowser = document.getElementById('tree-browser');
				//console.log(tabId, elm.children[tabId+1]);
				treeViewDOMData = [];
				var projectTab = elm.children[tabId+1];
				treeBrowser.innerHTML = showTreeDOM(projectTab, treeViewDOMData);
				currentProjectTabId = JsLayoutManager.getAutoId(projectTab);
			}
			
			function showPropertiesFor(event)
			{
				var target = JsLayoutManager.getEventSource(event);
				if(target && !this.contentEditable)
				{
					var elm = document.getElementById('widget-propery-type-name');
					if(elm)
					{
						currentWidgetId = JsLayoutManager.getAutoId(target);
						elm.innerHTML = "Widget " + target.nodeName + " > " + currentWidgetId;
						elm = document.getElementById('widget-propery-id');
						if(elm)
						{
							elm.value = currentWidgetId;
						}
						var signals = document.getElementById('widget-properties-signals');
						if(signals)
						{
							var prop, events_keys = [], ev_edit = ["<table>"];
							for(prop in target)
							{
								if(prop.indexOf("on") === 0)
								{
									events_keys.push(prop);
								}
							}
							events_keys.sort();
							for(var i=0, len=events_keys.length; i<len; ++i)
							{
								prop = events_keys[i];
								ev_edit.push("<tr><td>" + prop + "</td><td><input type='text' value='" + (target[prop] || "") + "'></td></tr>");
							}
							ev_edit.push("</table>");
							signals.innerHTML = ev_edit.join("");
						}
					}
				} else {
					currentWidgetId = false;
				}
			}

			function currWidgetSetId(theId)
			{
				if(currentWidgetId)
				{
					if(document.getElementById(theId))
					{
						alert("This id is already in use : " + theId);
						return;
					}
					var elm = document.getElementById(currentWidgetId);
					if(elm)
					{
						elm.id = currentWidgetId = theId;
					}
				}
			}
			
			function switchToSourceOrCodeView(bToSource)
			{
				if(currentProjectTabId)
				{
					var elm = document.getElementById(currentProjectTabId);
					if(elm)
					{
						var textProperty = "innerText";
						if( ! (textProperty in elm))
						{
							textProperty = "textContent";
						}
						if(bToSource)
						{
							if(elm.contentEditable !== "true")
							{
								elm[textProperty] = elm.innerHTML;
								elm.contentEditable = true;								
							}
						} else {
							if(elm.contentEditable === "true")
							{
								elm.innerHTML = elm[textProperty];
								elm.contentEditable = false;
							}
						}
					}
				}
			}

			function doSaveLoadHtmlContent(doSave, elmId)
			{
				var elm = document.getElementById(elmId);
				if(elm)
				{
					if(Storage)
					{
						if(doSave)
						{
							localStorage.setItem(elmId, elm.innerHTML);						
						} else {
							var txt = localStorage.getItem(elmId);
							if(txt)
							{
								elm.innerHTML = txt;
							}
						}
					}
				}
			}

			function manageMenuClick(event)
			{
				var target = JsLayoutManager.getEventSource(event);
				//console.log(target);
				var action = target.getAttribute("data-action");
				if(action)
				{
					switch(action)
					{
						case "save":
							doSaveLoadHtmlContent(true, currentProjectTabId);
							break;
						case "open":
							doSaveLoadHtmlContent(false, currentProjectTabId);
							break;
					}
				}
				//JsLayoutManager.menuClose(menu);
			}

		</script>
	</head>

	<body>

		<div id="root" data-layout="sz:'fullpage'">
			<div id="main-menu" data-layout="sz:'boxV'">
				<ul data-layout="sz:'menu',bar:1,ex:1" id="menu" onclick="manageMenuClick(event)">
					<li>File
						<ul data-layout="sz:'menu'">
							<li>New</li>
							<li data-action="open">Open</li>
							<li>Open recent<ul data-layout="sz:'menu'">
									<li>First</li>
									<li>Second</li>
									<li>Third</li>
								</ul>
							</li>
							<li data-action="save">Save</li>
							<li>Save As</li>
							<li>Properties</li>
							<li>Close</li>
							<li>Quit</li>
						</ul>
					</li>
					<li>Edit
						<ul data-layout="sz:'menu'">
							<li>Undo</li>
							<li>Redo</li>
							<li>Cut</li>
							<li>Copy</li>
							<li>Paste</li>
							<li>Delete</li>
						</ul>
					</li>
					<li>View
						<ul data-layout="sz:'menu'">
							<li>Toolbar</li>
							<li>Statusbar</li>
							<li>Project Tabs</li>
							<li>Palete Appearence
								<ul data-layout="sz:'menu'">
									<li>Text beside icons</li>
									<li>Icons only</li>
									<li>Text only</li>
									<li>Use samll icons</li>
								</ul>					
							</li>
							<li class="slmignore"><label>Dock Palette <input type="checkbox" checked="checked" id="dock-palette-checkbox" onchange="dockPaletteShowHide(this.checked);"></label></li>
							<li>Dock Inspector</li>
							<li class="slmignore"><label>Dock Properties <input type="checkbox" checked="checked" id="dock-properties-checkbox" onchange="dockPropertiesShowHide(this.checked);"></label></li>
						</ul>
					</li>
					<li>Project
						<ul data-layout="sz:'menu'">
							<li>Next Project</li>
							<li>Previous Project</li>
							<li>Unsave Project 1</li>
						</ul>
					</li>
					<li>Help
						<ul data-layout="sz:'menu'">
							<li>Developer Reference</li>
							<li>About</li>
						</ul>
					</li>
				</ul>
				<div id="toolbar" data-layout="ex:1" style="background-color:#cFc">
					<button onclick="switchToSourceOrCodeView(true)">Source</button><button onclick="switchToSourceOrCodeView(false)">Design</button>
				</div>
				<div data-layout="ex:1,p:1,sash:'20%',sz:'splitH',inverse:1">
					<div data-layout="ex:1,sash:'20%',sz:'splitH'">
						<div data-layout="ex:1,p:1,sz:'accordion'" id="box-palette">
							<div data-layout="title:'Actions'">
								<ul>
									<li>Action Group</li>
									<li>Action</li>
									<li>Toggle Action</li>
									<li>Radio Action</li>
									<li>Recent Acion</li>
								</ul>                        
							</div>
							<div data-layout="title:'Top Levels'">
								<ul onmousedown="startDragPalette(event);">
									<li>Window</li>
									<li>Offscreen Window</li>
									<li>Dialog Box</li>
									<li>About Dialog</li>
									<li>Color Selection Dialog</li>
									<li>File Chooser Dialog</li>
									<li>Font Selection Dialog</li>
									<li>Message Dialog</li>
									<li>Recent Chooser Dialog</li>
									<li>Assistant</li>
									<li>Application Chooser Dialog</li>
								</ul>
							</div>
							<div data-layout="title:'Containers'">
								<ul>
									<li>Box</li>
									<li>Grid</li>
									<li>Notebook</li>
									<li>Frame</li>
									<li>Aspect Frame</li>
									<li>Menu Bar</li>
									<li>Toolbar</li>
									<li>Tool Palette</li>
									<li>Paned</li>
									<li>Button Box</li>
									<li>Layout</li>
									<li>Fixed</li>
									<li>Event Box</li>
									<li>Expander</li>
									<li>Viewport</li>
									<li>Scrolled Window</li>
									<li>Alignment</li>
								</ul>                        
							</div>
							<div data-layout="title:'Control and Display'">
								<ul onmousedown="startDragPalette(event);">
									<li data-type="button">Button</li>
									<li>Toggle Button</li>
									<li data-type="checkbox">Check Button</li>
									<li data-type="radio">Radio Button</li>
									<li>Switch</li>
									<li data-type="input">Text Entry</li>
									<li>Spin Button</li>
									<li>Combo Box</li>
									<li>Combo Box Text</li>
									<li data-type="img">Image</li>
									<li data-type="label">Label</li>
									<li>Accel Label</li>
									<li>File Chooser Button</li>
									<li>Color Button</li>
									<li>Font Button</li>
									<li data-type="a">Link Button</li>
									<li>Scale Button</li>
									<li>Volume Button</li>
									<li>Application Chooser Button</li>
									<li>Scale</li>
									<li>Scrollbar</li>
									<li>Progess Bar</li>
									<li>Spinner</li>
									<li>Text View</li>
									<li>Tree View</li>
									<li>Icon View</li>
									<li>Handle Box</li>
									<li>Status Bar</li>
									<li>Calendar</li>
									<li>Popup Menu</li>
									<li>Separator</li>
									<li>Arrow</li>
									<li>Drawing Area</li>
									<li>Info Bar</li>
								</ul>                                                
							</div>
							<div data-layout="title:'Composite Widgets'">
								<ul>
									<li>Color Selection</li>
									<li>Font Selection</li>
									<li>Recent Chooser</li>
									<li>File Chooser Widget</li>
									<li>Application Chooser Widget</li>
								</ul>                        

							</div>
							<div data-layout="title:'Miscellaneous'">Miscellaneous</div>
						</div>
						<div data-layout="ex:1,sz:'boxV'">
							<div data-layout="p:1,ex:1,sz:'tab'" onchange="projectChanged(event)" id="tabs-projects">
								<div data-layout="title:'Unsaved 1'" onclick="showPropertiesFor(event);">
									<div id="x09s">Look on the left , there is an accordion
										<div class="exclude" style="background:red" data-layout="sz:'absolute',x:10,y:20,w:100,h:100">ABSOLUTE</div>
									</div>
								</div>
								<div data-layout="title:'Unsaved 2'" onclick="showPropertiesFor(event);">
									<form>
										<div id="x097s">											
											<label>Age <input type="number" name="age"></label>
											<label>Name <input type="text" name="name"></label>
										</div>
										<div>											
											<label>Address <input type="text" name="address"></label>
										</div>
										<div>											
											<label>Notes <textarea name="notes"></textarea></label>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
					<div data-layout="ex:1,sz:'boxV'" id="box-properties">
						<input type="text"  data-layout="ex:1" placeholder="&lt;Search Widgets&gt;">
						<div data-layout="ex:1,p:1,sash:'30%',sz:'splitV'">
							<div id="tree-browser"></div>
							<div data-layout="ex:1,sz:'boxV'">
								<div id="widget-propery-type-name">Widget input1 options</div>
								<div data-layout="p:1,ex:1,sz:'tab'">
									<div data-layout="title:'General'">
										<table>
											<tr><td>ID</td><td><input type="text" id="widget-propery-id" onchange="currWidgetSetId(this.value)"></td></tr>
											<tr><td>Name</td><td><input type="text"></td></tr>
											<tr><td>Editable</td><td><input type="checkbox"></td></tr>
											<tr><td>Maximun length</td><td><input type="number"></td></tr>
											<tr><td>Visibility</td><td><input type="checkbox"></td></tr>
											<tr><td>Has Frame</td><td><input type="checkbox"></td></tr>
											<tr><td>Invisible Character</td><td><input type="text"></td></tr>
										</table>
									</div>
									<div data-layout="title:'Packing'">
										<table>
											<tr><td>Position</td><td><input type="number"></td></tr>
											<tr><td>Padding</td><td><input type="number"></td></tr>
											<tr><td>Fill</td><td><input type="checkbox"></td></tr>
											<tr><td>Expand</td><td><input type="checkbox"></td></tr>
											<tr><td>Pack Type</td><td><select><option>start</option><option>end</option></select></td></tr>
										</table>
									</div>
									<div data-layout="title:'Common'">
									</div>
									<div data-layout="title:'Signals'" id="widget-properties-signals">
									</div>
								</div>
								<div><button>Reset defaults</button></div>								
							</div>
						</div>
					</div>
				</div>
				<div id="statusbar" data-layout="ex:1" style="background-color:#ccF">I'm the statusbar</div>
			</div>
		</div>

	</body>

</html>